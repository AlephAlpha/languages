stages: [init, build]

# template used for building docker images
.base:
  stage: build
  # TODO: add special tag to ensure the same runner is used for all jobs in this pipeline
  tags: [Linux, shell_executor]

init:
  extends: .base
  stage: init
  script:
    # we can't use the default $CI_REGISTRY_USER/$CI_REGISTRY_PASSWORD because they're per-job
    # and these credentials need to be shared for the entire pipeline
    - podman login "$CI_REGISTRY" -u "$DEPLOYTOKEN_USER" --password-stdin <<<"$DEPLOYTOKEN_PASSWORD"

include:
  # generated by gen_ci_config.py
  - local: .images.gitlab-ci.yml
